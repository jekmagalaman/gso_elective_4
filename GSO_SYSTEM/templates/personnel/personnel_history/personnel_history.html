{% extends "personnel/personnel_base_dashboard.html" %}

{% block title %}Task History{% endblock %}

{% block main_content %}
<div class="header d-flex justify-content-between align-items-center mb-3">
    <h1 class="page-title">TASK HISTORY</h1>
    <form method="get">
        <input type="text" name="q" class="form-control form-control-sm" placeholder="Search..." value="{{ request.GET.q }}">
    </form>
</div>

<div class="table-container table-responsive">
  <table class="table table-hover align-middle">
    <thead>
      <tr>
        <th>REQUEST ID</th>
        <th>REQUESTING OFFICE</th>
        <th>UNIT</th>
        <th>DATE SUBMITTED</th>
        <th>DATE COMPLETED</th>
        <th>STATUS</th>
      </tr>
    </thead>
    <tbody>
      {% for task in history %}
      <tr>
        <td>#{{ task.id }}</td>
        <td>{{ task.requestor.department }}</td>
        <td>{{ task.unit_of_measurement|default:task.unit|title }}</td>
        <td>{{ task.created_at|date:"Y-m-d" }}</td>
        <td>
        {% if task.completed_at %}
            {{ task.completed_at|date:"Y-m-d" }}
        {% else %}
            N/A
        {% endif %}
        </td>
        <td>
          <span class="status-badge status-{{ task.status|lower }}">
            ‚óè {{ task.status }}
          </span>
        </td>
      </tr>
      {% empty %}
      <tr>
        <td colspan="6" class="text-center text-muted">No completed tasks yet.</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}
