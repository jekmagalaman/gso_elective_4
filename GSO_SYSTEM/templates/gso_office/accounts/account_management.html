{% extends "gso_office/gso_base_dashboard.html" %}

{% block title %}Account Management{% endblock %}

{% block main_content %}
<div class="header d-flex align-items-center justify-content-between mb-3">
    <h1 class="page-title">ACCOUNT MANAGEMENT</h1>

    <div class="d-flex gap-2">
        <!-- Search + Status Filter -->
        <form method="get" class="d-flex gap-2">
            <input 
                type="text" 
                name="q" 
                class="form-control form-control-sm" 
                placeholder="Search users..." 
                value="{{ request.GET.q|default:'' }}"
                autocomplete="off"
            >

            <select name="status" class="form-select form-select-sm" onchange="this.form.submit()">
                <option value="">All Status</option>
                <option value="active" {% if request.GET.status == 'active' %}selected{% endif %}>Active</option>
                <option value="inactive" {% if request.GET.status == 'inactive' %}selected{% endif %}>Inactive</option>
            </select>
        </form>

        <!-- Add Account Button -->
        <a href="{% url 'gso_accounts:add_user' %}" class="btn btn-success btn-sm">+ Add Account</a>
    </div>
</div>

<div class="table-container table-responsive">
    <table class="table table-hover align-middle">
        <thead class="table-light">
            <tr>
                <th>NO.</th>
                <th>USER</th>
                <th>ROLE</th>
                <th>UNIT</th>
                <th>STATUS</th>
                <th>ACTION</th>
            </tr>
        </thead>
        <tbody>
            {% for user in users %}
            <tr>
                <!-- NO. -->
                <td>{{ forloop.counter }}</td>
        
                <!-- USER -->
                <td>
                    {% if user.role == "requestor" %}
                        {{ user.department.name }}
                    {% else %}
                        {{ user.get_full_name|default:user.username }}
                    {% endif %}
                </td>
        
                <!-- ROLE -->
                <td>{{ user.get_role_display }}</td>
        
                <!-- UNIT -->
                <td>
                    {% if user.unit %}
                        {{ user.unit.name }}
                    {% else %}
                        â€”
                    {% endif %}
                </td>
        
                <!-- STATUS -->
                <td>
                    {% if user.account_status == "active" %}
                        <span class="badge bg-success">Active</span>
                    {% else %}
                        <span class="badge bg-danger">Inactive</span>
                    {% endif %}
                </td>
        
                <!-- ACTION -->
                <td>
                    <a href="{% url 'gso_accounts:edit_user' user.id %}" class="btn btn-sm btn-primary">Edit</a>
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="6" class="text-center text-muted">No users found.</td>
            </tr>
            {% endfor %}
        </tbody>
        
    </table>
</div>
{% endblock %}
